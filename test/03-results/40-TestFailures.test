# ensures that tmtest -f works.
#
# We verify that it runs all tests and only prints the ones that fail.
# We hit it with a succeeding test, a failing test, and a disabled test.
# We can't hit it with an abort test since that would stop the test run.

cat > success.test <<-EOL
	# ensure this test isn't printed
	echo HI
	STDOUT:
	HI
EOL

cat > fail.test <<-EOL
	# ensure this test is printed
	echo HI
	STDOUT:
	HO
EOL

cat > disabled.test <<-EOL
	# this test would succeed if it weren't disabled
	DISABLED
	echo HI
	STDOUT:
	HI
EOL

mkdir subdir
cat > subdir/fail.test <<-EOL
	# make sure we show the proper path in subdirectories
	echo HI
	STDOUT:
	HO
EOL

set +e  # tmtest will return an error since a test failed
$tmtest -f .

rm success.test fail.test disabled.test
rm -rf subdir

STDOUT:
fail.test
subdir/fail.test
